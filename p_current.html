<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
	<a href="https://plus.google.com/106183157602618292373?rel=author">Google</a>
	<a href="https://plus.google.com/106183157602618292373" rel="publisher">Find us on Google+</a>
	<title>Current squarer</title>
	<link rel="canonical" href="http://onmyphd.com/p_current/" />
	<meta name="google-site-verification" content="qS-ONqo-b5-NzkWSBgPnv5l5gN7ddcorKuN6ZAfnAoI"/>
	<meta name="description" content="The current squarer is a circuit that outputs the square of the input current">
	<meta name="keywords" content="mosfet, cmos, 3T, circuit, square, current">
	<meta name="author" content="Hugo GonÃ§alves"> 
	<meta property="fb:admins" content="100004669092914"/>
	<!-- Auto ads by google -->
	<!-- end -->
	<script>
	// Google Analytics
	</script>
</head>
<body>
<script src="../ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script>
 var page = 'current.squarer';// Add event listener compatible with all browsers
function addEvent(e, ev, f) {
	// W3C DOM || IE DOM
	if (e.addEventListener) e.addEventListener(ev,f,false)
	else if (e.attachEvent) e.attachEvent("on"+ev, f);
}
// Asynchronous load of script
function loadJS(src, callback) {
	var e = document.createElement('script'); e.type = 'text/javascript'; e.async = true; e.src = src;
	if (callback) addEvent(e, 'load', callback);
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(e, s);
}
function loadJSonce(src, id, callback) {
	var s = document.getElementsByTagName('script')[0];
	if(!s.getElementById(id)) loadJS(src, callback);
}
function r(obj, f) {
	var a = [].slice.call(arguments);
	var f = a[a.length - 1];
	f.apply(undefined, a.slice(0,-1));
}
_jQ = jQuery;
_phd = jQuery.phd;
</script>
<script type="text/javascript" src="../components/js/phd.js"></script>
<div id="logo"><a id="about.me" class="page" href="/" style="color:white">OnMyPhD</a></div>
<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.async = true;
  js.src = "http://connect.facebook.net/en_US/all.js#xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<div id="fb" class="fb-like" data-href="http://www.facebook.com/onmyphd" data-send="false" data-width="60" data-show-faces="false" data-colorscheme="dark" width="60" data-layout="button_count"></div>
<div id="search">
<input id="searchbox" class="searchempty" type="text" value="Search..."/>
</div>
<div id="top"></div>
<div id="pages">
<h1>Current squarer</h1>
<h2>What do you need to know to understand this topic?</h2>
<ul>
<li>Circuit theory</li>
<li><a href="../p_mosfet/" id="mosfet.transistor" class="page"> MOSFET transistors</a></li>
</ul>
<h2>What is a current squarer?</h2>
<p>
It is a circuit that outputs the square value of the input current. It is used has a building block for analog multipliers, rectifiers, etc. There are many ways of designing a current squarer, but all are based on the square-law relation between drain current and gate-source voltage for transistors in strong inversion.
</p>
<h2>3T current squarer</h2>
<p>
The 3 transistor current squarer is a very compact way of squaring a current.
</p>
<center>
<img src="../pages/current.squarer/3t.current.squarer.svg" width="300" class="svg"/>
</center>
<p>
The square-law for transistors $M_1$ and $M_2$ is
$$I_1 = \beta(V_1 - V_{TH})^2$$
$$I_2 = \beta(V_2 - V_1 - V_{TH})^2$$
where $\beta=1/2\mu_nC_{ox}W/L$. First, let's work $I_2$ a little bit
$$I_2 = \beta( (V_2 -2V_{TH}) - (V_1 - V_{TH}))^2$$
$$I_2 = \beta\left( (V_2 -2V_{TH})^2 - 2(V_2 -2V_{TH})(V_1 - V_{TH}) + (V_1 - V_{TH})^2 \right)$$
$$I_2 = \beta\left( (V_2 -2V_{TH})^2 - 2(V_2 -2V_{TH})(V_1 - V_{TH}) + \frac{I_1}{\beta}\right)$$
$$\frac{I_2}{\beta} = (V_2 -2V_{TH})^2 - 2(V_2 -2V_{TH})(V_1 - V_{TH}) + \frac{I_1}{\beta}$$
$$V_1 - V_{TH} = \frac{(V_2 -2V_{TH})^2 + \frac{I_1}{\beta} - \frac{I_2}{\beta}}{2(V_2 -2V_{TH})}.$$
Now we place the expression above in $I_1$:
$$\begin{equation}I_1 = \beta \left(\frac{(V_2 -2V_{TH})^2 + \frac{I_1}{\beta} - \frac{I_2}{\beta}}{2(V_2 -2V_{TH})}\right)^2\label{eq:eq1}\end{equation}$$
Looking at the circuit above and noting that $I_1 = I_3$, we see that:
$$I_{out} = I_1 + I_2$$
$$I_{in} = I_1 - I_2$$
Turning the variables around, we get:
$$I_1 = \frac{I_{out} + I_{in}}{2}$$
$$I_2 = \frac{I_{out} - I_{in}}{2}$$
Replacing $I_1$ and $I_2$ in $\eqref{eq:eq1}$, we get:
$$ \frac{I_{out} + I_{in}}{2} = \beta\left(\frac{(V_2 -2V_{TH})^2 + \frac{I_{out} + I_{in}}{2\beta} - \frac{I_{out} - I_{in}}{2\beta}}{2(V_2 -2V_{TH})}\right)^2$$
$$ \frac{I_{out} + I_{in}}{2} = \beta\left(\frac{(V_2 -2V_{TH})^2 + \frac{I_{in}}{\beta}}{2(V_2 -2V_{TH})}\right)^2$$
$$ \frac{I_{out} + I_{in}}{2} = \beta\left(\frac{V_2 -2V_{TH}}{2} + \frac{ I_{in}}{2\beta(V_2 -2V_{TH})}\right)^2$$
$$ I_{out} + I_{in} = 2\beta\left(\frac{(V_2 -2V_{TH})^2}{4} + \frac{I_{in}}{2\beta} + \frac{I_{in}^2}{4\beta^2(V_2 -2V_{TH})^2}\right)$$
$$ I_{out} = 2\beta\left(\frac{(V_2 -2V_{TH})^2}{4} + \frac{I_{in}^2}{4\beta^2(V_2 -2V_{TH})^2}\right)$$
$$ I_{out} = \beta\left(\frac{(V_2 -2V_{TH})^2}{2} + \frac{I_{in}^2}{2\beta^2(V_2 -2V_{TH})^2}\right)$$
By defining a current $I_b = \beta(\frac{V_2}{2} - V_{TH})^2$ , we get:
$$ I_{out} = 2I_b + \frac{I_{in}^2}{8I_b}$$
The output current $I_{out}$ has a constant term (only depends on $V_2$) and a term that depends on the square of the input current $I_{in}$.
</p>
<h3>Dynamic range of input current</h3>
<p>
When the input current reaches $4I_b$, the output current is also $4I_b$. According to the expression $I_2 = \frac{I_{out} - I_{in}}{2}$, that means that $I_2 = 0$, and above this value the circuit does not work. In the case of negative input current (flowing in the opposite direction), the same boundary applies because $I_1 = \frac{I_{out} + I_{in}}{2} = 0$. Therefore,  $|I_{in}| \le 4I_b$ for the circuit to work.
</p>
<h3>Non-idealities</h3>
<p>
Non-idealities in the transistors affect the accuracy of the squarer. Namely:
<ol type="a">
<li> Mismatches and process variations between transistors make some terms not to cancel perfectly, which leads to an error term</li>
<li> $M_2$ suffers from body effect, making its $V_{TH}$ dependent on $V_1$. Using a flipped version with only PMOS can solve this problem, because the bulk of each PMOS transistors can be tied to any node, including its own source terminal</li>
<li> Channel length modulation makes the voltage at the output node affect the square-law relation</li>
</ol>
The errors can be introduced in the expression as:
$$I_{out} = 2I_b + e_1 + \frac{(I_{in}+e_2)^2}{8I_{b}}$$
where $e_1$ is the error associated to the output and $e_2$ is the error associated to the input.
</p>
<script type="text/javascript" src="../pages/current.squarer.js"></script>
<div id="social">
If I helped you in some way, please help me back by liking this website on the bottom of the page or clicking on the link below. It would mean the world to me!<p>
<table>
<tr>
<td width="100"><!-- Facebook -->
<div id="fb-like-page" class="fb-like" data-href="http://www.onmyphd.com/?p=current.squarer" data-send="false" data-width="90" data-show-faces="false" data-layout="button_count"></div>
</td>
<td width="100"><!-- Google+ -->
<div class="g-plusone"></div>
<script type="text/javascript">
loadJS('../js/plusone.js');
</script>
</td>
<td width="100"><!-- Twitter -->
<a href="https://twitter.com/share" class="twitter-share-button" data-via="Onmyphd">Tweet</a>
<script>
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.async=true;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>
</td>
<td width="100"><!-- Linkedin -->
<script>
if (typeof (IN) != 'undefined') {
    IN.parse();
} else {
   loadJS("../in.js");
}
</script>
<script type="IN/Share" data-url="http://www.onmyphd.com/?p=current.squarer" data-counter="right"></script>
</td>
</tr>
</table>
</div>
</div>
<div id="sidebar" style="position:absolute;width:250px;top:50px;left:940px;"></div>
<!-- <div id="poll1" style="position:absolute;width:250px;top:140px;left:940px;"></div>
<div id="poll2" style="position:absolute;width:250px;top:380px;left:940px;"></div>-->
<div id="menu">
<a id="mn_contents" class="page" href="../p_contents/">Contents</a> |
<a id="mn_resources" class="page" href="../p_resources/">Resources</a>
<!--<a id="mn_plot" class="page" href="?p=plot">Plot a chart</a>--> ||
<a id="mn_print" class="page" href="../print_p_current_squarer/">Print</a>
</div>
<div id="socialfixed"><b>Show your love:</b><br/><!-- Facebook -->
<span id="fb-like-page" class="fb-like" data-href="http://www.onmyphd.com/?p=current.squarer" data-send="false" data-width="90" data-show-faces="false" data-layout="button_count"></span>
<!-- Google+ -->
<div class="g-plusone"></div>
<script type="text/javascript">
loadJS('../js/plusone.js');
</script>
<!-- Twitter -->
<a href="https://twitter.com/share" class="twitter-share-button" data-via="Onmyphd">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.async=true;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
</script>
<!-- Linkedin -->
<script>
if (typeof (IN) != 'undefined') {
    IN.parse();
} else {
   loadJS("../in.js");
}
</script>
<script type="IN/Share" data-url="http://www.onmyphd.com/?p=current.squarer" data-counter="right"></script>
</div>
<div id="footer"><span id="message"></span></div>
<script>
jQuery (function ($) {
	// avoid loading javascript for the two main pages, as it would replicate the toc
	if (page != 'contents' && page != 'about.me' && page != '404')
	{
		$.phd.onload('#pages');
		$("#pages a.page").attr({rel: 'external', target: '_blank'});
		$.phd.cite('#pages');
		//$.phd.ads('#pages');
	}
	/*$('#searchbox').hide();
	$('#searchtoggle').click( function () {
		if ($('#searchbox').toggle().is(':visible')) {			
			$(this).html('Search &#x25B2;');
		} else {
			$(this).html('Search &#x25BC;');
		}
		return false;
	});*/
	// search box
	$('#searchbox')
	.focus( function () {
		if ( $(this).hasClass('searchempty') )
			$(this).val('').removeClass('searchempty')
	})
	.blur( function () {
		if ( $(this).val() == '' )
			$(this).val('Search...').addClass('searchempty');
	})
	.on('keydown', function (e) {
		if (e.which == 13) {
			window.open('http://www.google.com/search?sitesearch=onmyphd.com&q=' + $(this).val(), '_blank');
		}
    });
});
</script>
<link href="../main.css" rel="stylesheet" type="text/css">
</body>
</html>